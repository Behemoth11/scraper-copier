$(document).ready(function(){var preferredhost=0;var player_cont=$('#video-container');var matched=false;var mp4sh_match=false;var watchHistory=!!Cookies.get("watchHistory")?JSON.parse(Cookies.get("watchHistory")):null;if(watchHistory!=null){watchHistory=watchHistory.filter(function(index){if((index.duration-index.time)/index.duration<0.01){return false;}
return true;})
Cookies.set("watchHistory",JSON.stringify(watchHistory),{expires:365});}
for(let index=0;index<json.length;index++){let e=json[index];if(e.host=="mp4.sh"&&e.type==preferredtype){preferredhost=index;matched=true;break;}
if(e.type==preferredtype){preferredhost=index;matched=true;}
if(e.host=="mp4.sh"){mp4sh_match=index;}}
if(!matched){preferredhost=mp4sh_match?mp4sh_match:0;}
function check_resume(){var resume='';if(typeof watchHistory!=="undefined"&&watchHistory!==null){var data=watchHistory;data=data.find(function(obj){return obj.id===episode.episode_id;})||false;if(data){resume="?s="+data.time+":"+data.duration;}}
$('iframe#video')[0].src=$('iframe#video')[0].src+resume;}
setTimeout(function(){if(preferredhost){player_cont.html(json[preferredhost].player);}else{player_cont.html(json[0].player);}
player_cont.html(json[preferredhost].player);check_resume();$('*[data-array="'+preferredhost+'"]').addClass('disabled');},100);$(document).on("click",".server",function(){var index=$(this).attr('data-array');player_cont.html(json[index].player);check_resume();$('#video').on('load',function(){$('#video').show();});$('.server.disabled').removeClass('disabled');$(this).addClass('disabled');});if(!!Cookies.get('_autoplay')){$('#autoplay-toggle')[0].checked=Cookies.get('_autoplay')=="true";}else{Cookies.set('_autoplay',true,{expires:365,path:'/'});$('#autoplay-toggle')[0].checked=true;}
$('#autoplay-toggle').click(function(){if(this.checked){Cookies.set('_autoplay',true,{expires:365,path:'/'});}else{Cookies.set('_autoplay',false,{expires:365,path:'/'});}});function bindEvent(element,eventName,eventHandler){if(element.addEventListener){element.addEventListener(eventName,eventHandler,false);}else if(element.attachEvent){element.attachEvent('on'+eventName,eventHandler);}}
bindEvent(window,'message',function(e){if(e.origin==="http://trollvid.net"||e.origin==="https://trollvid.net"||e.origin==="https://mp4.sh"||e.origin==="https://ww1.animesimple.com"){var data=e.data;if(typeof data.time!=='undefined'&&data.status==='playing'){data.id=episode.episode_id;data.anime_id=episode.anime_id;data.lang=$('#mirrors server.active').attr("data-type");if(!!Cookies.get("watchHistory")){watchHistory=JSON.parse(Cookies.get("watchHistory"));watchHistory=watchHistory.filter(function(obj){return obj.anime_id!==episode.anime_id;});watchHistory.push(data);if(watchHistory.length>8)
watchHistory.shift();Cookies.set("watchHistory",JSON.stringify(watchHistory),{expires:365});}else{watchHistory=[];watchHistory.push(data);Cookies.set("watchHistory",JSON.stringify(watchHistory),{expires:365});}}
if(data.status=="complete"&&Cookies.get('_autoplay')=="true"){if(episode.next_episode_url){window.location.href=episode.next_episode_url;}}}});});